{% extends "base_star.html" %}
{% load static %}
{% block title %}rdenes{% endblock %}

{% block extra_head %}
<style>
  .slx-card{
      background:#fff;
      border-radius:10px;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
      padding:22px 24px;
  }
  .table th,.table td{vertical-align:middle;}
  .btn-sm{padding:3px 10px;}
  .table tbody tr{background:#fff !important;}
  .table tbody tr:hover{background:#f5f7fb !important;transition:background .15s ease-in-out;}

  /* 锔 Buscador ancho para no cortar placeholder */
  .input-buscar {
      width: 360px !important;
  }

  /* 锔 Centrado PERFECTO del bot贸n Nueva orden */
  .btn-nueva-orden {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      padding-top: 6px !important;
      padding-bottom: 6px !important;
      border-radius: 10px !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="slx-card mt-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4 class="mb-0">rdenes registradas</h4>

    <div class="d-flex gap-2">

      <form method="get" class="d-flex">
        <input type="text"
               name="q"
               value="{{ query }}"
               class="form-control form-control-sm me-2 input-buscar"
               placeholder="Buscar por nombre, c茅dula o n煤mero de orden">
        <button type="submit" class="btn btn-sm btn-outline-primary">Buscar</button>
      </form>

      <!-- 锔 Bot贸n centrado EXACTAMENTE como pediste -->
      <a href="{% url 'nueva_orden' %}" class="btn btn-sm btn-primary btn-nueva-orden">
        <i class="mdi mdi-account-plus-outline"></i> Nueva orden
      </a>

    </div>
  </div>

  <div class="table-responsive">
    <table class="table table-hover align-middle">
      <thead class="table-light">
        <tr>
          <th>Orden</th>
          <th>Paciente</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th style="width:220px;" class="text-end">Acciones</th>
        </tr>
      </thead>

      <tbody>
        {% for orden in ordenes %}
        <tr>

          <td class="fw-semibold">{{ orden.numero_orden }}</td>

          <td>
            <div class="fw-semibold">{{ orden.paciente.nombre_completo }}</div>
            <div class="text-muted small">{{ orden.paciente.documento_identidad }}</div>
          </td>

          <td>
            <i class="mdi mdi-calendar-clock me-1"></i> {{ orden.fecha|date:"d/m/Y H:i" }}
          </td>

          <td>
            <span class="badge bg-light text-dark">{{ orden.estado }}</span>
          </td>

          <td class="text-end">

            <a href="{% url 'detalle_orden' orden.id %}"
               class="btn btn-sm btn-outline-primary me-1">
              <i class="mdi mdi-eye-outline"></i> Revisar
            </a>

            <!-- Ь Etiquetas (revisi贸n e impresi贸n) -->
            <a href="{% url 'orden_etiquetas_pdf' orden.id %}" target="_blank" rel="noopener"
               class="btn btn-sm btn-outline-dark me-1">
              <i class="mdi mdi-barcode"></i> Etiquetas
            </a>

            {% if orden.estado == "Validado" %}
              <a href="{% url 'imprimir_informe' orden.id %}" target="_blank" rel="noopener"
                 class="btn btn-sm btn-outline-success me-1">
                <i class="mdi mdi-file-document-outline"></i> Informe
              </a>
            {% else %}
              <button class="btn btn-sm btn-outline-secondary me-1" disabled>
                <i class="mdi mdi-file-document-outline"></i> Informe
              </button>
            {% endif %}

            <a href="{% url 'orden_pdf' orden.id %}"
               class="btn btn-sm btn-outline-secondary">
              <i class="mdi mdi-file-pdf-box"></i> Detalle
            </a>

          </td>

        </tr>
        {% empty %}
        <tr>
          <td colspan="5" class="text-center text-muted py-3">
            No hay 贸rdenes registradas
          </td>
        </tr>
        {% endfor %}
      </tbody>

    </table>
  </div>

</div>
{% endblock %}
